package org.nofdev.common;

/// ## 基本单据的生命周期状态
/// * 关键特征：
///     * 面向抽象，每个状态的规则，标品定义基本规则，业务定义补充规则
/// * 部分成功或失败终态场景：
///     * 可以为COMPLETED，也可以为TERMINATED，主要判断依据为业务目标是否达成
///     * 需通过状态属性executionDetail记录部分执行详情和后续处理方式，如入库拒收，释放预算等
///     * 终止后处理规则的执行可定义为插件或者条件+动作的规则引擎，感觉这个地方直接二开编码是最方便的做法
///
public enum BasicLifecycleState {
    /// ## 初始化
    /// * 核心定义：实体已创建但未满足 “业务最小完整性”，处于临时编辑状态，不具备参与业务流程的合法性。
    /// * 关键特征：
    ///     * 允许不完整（如订单缺少价格、采购单缺少供应商），字段可随意修改；
    ///     * 不触发任何业务规则校验（如库存检查、权限校验）；
    ///     * 不占用业务资源（如不锁定库存、不影响可用量）；
    ///     * 可直接删除（因未进入业务流程，无需记录删除原因）。
    ///     * 审批过程中驳回进入INITIALIZED状态
    /// * DDD 实体性：属于 “草稿实体”（Draft Entity），尚未满足聚合根的完整约束，但已在领域模型中存在（区别于纯粹的内存临时对象）。
    INITIALIZED,
    /// ## 待确认
    /// * 核心定义：实体已满足 “业务最小完整性”（字段必填项校验通过），提交后等待业务规则确认，处于 “预生效”状态。
    /// * 关键特征：
    ///     * 字段修改受限（仅允许补充非关键信息，如备注，不可修改核心字段如金额、数量）；
    ///     * 触发基础校验（如格式校验、必填项校验），但未通过业务规则校验（如信用额度检查、库存可用性检查）；
    ///     * 可能进入审批流（如超过阈值的采购单需经理审批），状态会随审批节点流转（但审批节点属于流程状态，非主状态）；
    ///     * 可退回至初始化状态（需记录退回原因，保留修改轨迹）。
    /// * 业务意义：标志实体从 “编辑态”进入 “业务流程态”的过渡，是实体合法性的第一道门槛。
    PENDING_CONFIRM,
    /// ## 预确认
    /// * 核心定义：实体通过业务规则校验（含审批），已完成 TCC Try 阶段（预占资源/锁定结果），等待 TCC Confirm/Cancel 阶段落地，处于“预生效待确认”状态。
    /// * 关键特征（TCC 核心承载）：
    ///     * 对应 TCC Try 阶段完成：已锁定核心资源（如采购单预占编号、库存预占），不可重复执行 Try；
    ///     * 状态不可直接修改：需通过 Confirm（转 CONFIRMED）或 Cancel（转 TERMINATED/PENDING_CONFIRM）触发流转；
    ///     * 依赖 `executionDetail` 记录 TCC 信息：如预占资源 ID（stockReserveId）、Try 阶段执行时间、Confirm/Cancel 触发条件；
    ///     * XXX，不使用TCC设计思路的单据可以没有此状态
    ///     * 业务意义：标志实体从“业务规则确认”进入“资源落地确认”，是 TCC 逻辑的核心中间节点。
    PRE_CONFIRMED,
    /// ## 已确认（CONFIRMED）
    /// * 核心定义：实体通过所有业务规则校验（含审批），具备完整业务合法性，进入执行阶段，成为 “生效实体”。
    /// * 关键特征：
    ///     * 核心字段不可修改（如需修改需走 “变更流程”，生成新版本实体）；
    ///     * 触发资源锁定（如订单锁定库存、付款单锁定预算）；
    ///     * 是业务流程的 “起点”（如确认后的采购单可下推入库单、确认后的销售单可安排发货）；
    ///     * 可触发下游业务事件（如发布 “实体确认事件”，通知关联模块准备执行）。
    ///     * 本质是资格确认
    ///     * 当前状态触发反审核后进入INITIALIZED
    /// * DDD 实体性：正式成为 “聚合根”，具备完整的领域行为和业务价值，是领域模型中 “可追踪、可审计” 的核心实体。
    CONFIRMED,
    /// ## 执行中
    /// * 核心定义：已确认的实体进入实际业务执行阶段，部分或全部业务目标正在达成，处于 “动态变化” 状态。
    /// * 关键特征：
    ///     * 允许 “部分完成”（如订单发货 50%、付款单支付 30%），需记录执行进度；
    ///     * 可能触发中间状态事件（如 “部分发货事件”“部分付款事件”）；
    ///     * 执行中的异常（如发货延迟、付款失败）不改变主状态，但需记录异常标记；
    ///     * 不可直接取消（需先终止执行，如 “中止发货”“暂停付款”）。
    ///     * 本质是动作启动，自动化程度高时，CONFIRMED后紧跟IN_PROGRESS。其他时候可以业务自行定义启动节点
    ///     * 当前状态触发反审核后进入TERMINATED
    /// * 业务意义：覆盖实体从 “确认生效” 到 “最终完成” 之间的所有动态过程，是业务执行的核心监控节点。
    IN_PROGRESS,
    /// ## 已完成
    /// * 核心定义：实体的全部业务目标已达成，且通过最终校验，进入 “终态”。
    /// * 关键特征：
    ///     * 执行进度 100%（如订单全量发货、付款单全额支付）；
    ///     * 触发资源释放（如订单完成后解锁超额锁定的库存、付款单完成后释放预算占用）；
    ///     * 不可修改任何业务字段（仅允许添加备注、附件等非核心信息）；
    ///     * 可触发归档流程（如按 retention policy 进入历史数据区）。
    ///     * 部分成功状态为已完成
    ///     > 已完成状态的定义是 “全部业务目标已达成”，但 “业务目标” 可柔性定义为 “按实际执行结果确认完结”（而非 “100% 执行”）。部分成功场景中，“已成功部分保留 + 未成功部分释放” 本质是 “业务目标已调整并达成”（即 “接受部分执行，终止剩余部分”），符合 “终态” 的特征（不可逆向转换）。
    ///     * 当前状态不可触发反审核
    /// * 终态属性：一旦进入，不可逆向转换至非终态（区别于执行中、待确认等中间态）。
    COMPLETED,
    /// ## 已终止
    /// * 核心定义：实体在达成全部业务目标前，因主动取消或被动异常导致生命周期提前结束，进入 “终态”。
    /// * 关键特征：
    ///     * 需明确终止原因（如 “客户取消”“库存不足”“审批驳回”），原因需符合业务规则；
    ///     * 触发资源回滚（如取消订单释放锁定库存、终止付款单返还预算）；
    ///     * 终止后不可再执行任何业务操作（如取消的订单不能再发货、终止的付款单不能再支付）；
    ///     * 保留完整的终止轨迹（谁终止、何时终止、关联审批记录）。
    ///     * 当前状态不可触发反审核
    /// * 细分场景适配：
    ///     * 主动终止：如客户取消订单、采购方终止合同；
    ///     * 被动终止：如系统检测到欺诈订单、付款单超过有效期未支付。
    ///     * 对于能否进入TERMINATED，取决于事实判断而非后续动作是否结束，要分开来看。比如取消发货拦截失败，这是取消后的遗留问题，不会改变发货单已取消的事实
    TERMINATED
}
