@startuml
title 分层架构图
' 全局配置：设置布局方向、皮肤、间距
skinparam component {
  BackgroundColor #f9f9f9
  BorderColor #333333
  BorderThickness 1
  RoundCorner 10
  FontName "Microsoft YaHei"
  FontSize 11
}
skinparam package {
  BackgroundColor #ffffff
  BorderColor #666666
  BorderThickness 1
  RoundCorner 15
  FontSize 12
  FontWeight bold
}
skinparam note {
  BackgroundColor #f0f8ff
  BorderColor #4169e1
  FontSize 10
}

' 布局方向：自上而下
'left to right direction
top to bottom direction

' ========== 接入层（presentation） ==========
package "接入层（presentation）" as presentationLayer {
  component "rpc组件（rpc）" as rpc
  note bottom of rpc: grpc等
  component "http组件（http）" as http
  component "进程内调用组件（intra-process）" as intraProcess
  note bottom of intraProcess: 模块化单体的内部调用走这里
  component "事件处理组件（event）" as event
  note bottom of event: 定时任务可以看作对于时间事件的处理
  component "MQTT组件" as mqtt
  component "Webhook组件" as webhook
}

' ========== 业务层 ==========
package "业务层（application）"  as applicationLayer {
  component "command组件（application）" as command
  note right of command: 设计之初就走主库
  component "query组件（query）" as query
  note right of query: 设计之初就走从库
  component "编排组件（orchestration）" as orchestration
}
note right of orchestration
  职责说明：
  1. 任务调度map-reduce逻辑中可调用query查询、command执行逻辑、上报进度等
  2. 事件处理中，也可编排query和command
end note

' ========== 领域层（domain） ==========
package "领域层（domain）" as domainLayer {
  component "领域层（domain）" as domain
}

' ========== 基础设施层 ==========
package "基础设施层（infrastructure）" as infrastructureLayer {
  component "基础设施（infrastructure）" as infra
  component "应用配置（starter）" as starter
  component "依赖管理（dependency-management）" as dependency
}

' ========== 二方包（common） ==========
component "二方包（common）" as common

' 层级依赖关系（自上而下，依赖倒置）
presentationLayer --> applicationLayer
orchestration --> command
orchestration --> query
applicationLayer --> domainLayer
infrastructureLayer -u-> domainLayer
common .[hidden]. infrastructureLayer
@enduml